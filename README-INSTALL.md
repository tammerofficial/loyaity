# 🚀 Laravel Auto Install System
## نظام التثبيت التلقائي للارافيل

هذا نظام تثبيت شامل يحل جميع مشاكل النشر تلقائياً ويضمن عمل التطبيق بدون أخطاء 500 أو مشاكل أخرى.

## 📋 المتطلبات الأساسية

- PHP 8.2+ مع الامتدادات المطلوبة
- MySQL/MariaDB
- Composer
- Git (اختياري)
- Node.js & NPM (للـ assets)

## 🛠️ طرق التثبيت

### 1. التثبيت التلقائي الكامل (موصى به)

```bash
# تحميل وتشغيل التثبيت التلقائي
chmod +x install.sh
./install.sh
```

### 2. التثبيت المخصص لـ Cloudways

```bash
# للخوادم المستضافة على Cloudways
chmod +x install-cloudways.sh
./install-cloudways.sh
```

### 3. التثبيت عبر PHP (للاستضافة المشتركة)

```bash
# يعمل على جميع أنواع الاستضافة
php quick-install.php
```

### 4. التثبيت عبر Artisan

```bash
# استخدام أداة Laravel المخصصة
php artisan-install
```

### 5. التثبيت عبر المتصفح

1. ارفع الملف `quick-install.php` إلى المجلد الجذر
2. اذهب إلى `yoursite.com/quick-install.php`
3. اتبع التعليمات على الشاشة

## 🔧 ما يقوم به النظام تلقائياً

### ✅ فحص النظام
- فحص إصدار PHP والامتدادات المطلوبة
- فحص صلاحيات الملفات
- اكتشاف بيئة الخادم تلقائياً

### ⚙️ إعداد البيئة
- إنشاء ملف `.env` بالإعدادات المحسنة
- توليد مفتاح التطبيق
- إعداد قاعدة البيانات

### 📦 تثبيت المتطلبات
- تثبيت مكتبات Composer
- تثبيت مكتبات Node.js وبناء الـ assets
- ربط مجلد التخزين

### 🗄️ إعداد قاعدة البيانات
- تشغيل migrations
- زراعة البيانات الأولية (في بيئة التطوير)

### ⚡ تحسين الأداء
- تفعيل cache للـ config والـ routes والـ views
- ضغط الملفات وتحسين الصور
- إعداد headers الأمان

### 🔐 الأمان والصلاحيات
- ضبط صلاحيات الملفات والمجلدات
- إعداد .htaccess المحسن
- تفعيل HTTPS والحماية من XSS

## 📁 الملفات المُنشأة

بعد التثبيت ستجد الملفات التالية:

```
project/
├── .env                    # ملف الإعدادات
├── installation-info.json  # معلومات التثبيت
├── deployment-info.json    # معلومات النشر
├── deploy-cloudways.sh     # سكريبت النشر لـ Cloudways
├── auto-deploy.sh          # سكريبت النشر التلقائي
├── .user.ini              # إعدادات PHP المحسنة
├── public/.htaccess       # إعدادات Apache المحسنة
└── storage/logs/          # ملفات السجلات
```

## 🌐 إعدادات البيئات المختلفة

### Cloudways
- اكتشاف تلقائي لمعرف التطبيق
- إعداد قاعدة البيانات تلقائياً
- تحسينات مخصصة للأداء

### cPanel/الاستضافة المشتركة
- دعم المجلدات الفرعية
- إعدادات محسنة للذاكرة
- سهولة الإدارة من لوحة التحكم

### VPS/الخوادم المخصصة
- تحكم كامل في الخادم
- تحسينات مخصصة متقدمة
- دعم شهادات SSL

## 🔍 فحص الصحة

يُنشئ النظام endpoint للفحص تلقائياً:

```
GET /health
```

يعيد استجابة JSON تحتوي على:
```json
{
    "status": "ok",
    "timestamp": "2024-01-13T10:30:00Z",
    "app": "Tammer Loyalty",
    "environment": "production",
    "version": "1.0.0"
}
```

## 🔄 النشر التلقائي

للنشر والتحديث المستقبلي:

```bash
# نشر تلقائي مع نسخ احتياطية
./auto-deploy.sh

# إنشاء نسخة احتياطية فقط
./auto-deploy.sh backup

# استعادة من النسخة الاحتياطية
./auto-deploy.sh restore

# عرض حالة النشر
./auto-deploy.sh status
```

## 🛡️ النسخ الاحتياطية

النظام ينشئ نسخ احتياطية تلقائياً:

### قاعدة البيانات
- مضغوطة بـ gzip
- محفوظة في `backups/database/`
- يحتفظ بآخر 5 نسخ

### الملفات
- مضغوطة بـ tar.gz
- محفوظة في `backups/files/`
- يحتفظ بآخر 3 نسخ

## 🔧 استكشاف الأخطاء

### خطأ 500 Internal Server Error
```bash
# فحص السجلات
tail -f storage/logs/laravel.log

# إعادة ضبط الصلاحيات
chmod -R 755 storage bootstrap/cache

# مسح الـ cache
php artisan optimize:clear
```

### مشاكل قاعدة البيانات
```bash
# فحص الاتصال
php artisan migrate:status

# إعادة تشغيل migrations
php artisan migrate:fresh --seed
```

### مشاكل Apple Wallet
```bash
# فحص الشهادات
ls -la certs/
openssl pkcs12 -info -in certs/tammer.wallet.p12
```

## 📱 إعداد Apple Wallet

1. تأكد من وجود الشهادات في مجلد `certs/`
2. أدخل كلمة مرور الشهادة في `.env`
3. تحقق من `TEAM_ID` و `PASS_TYPE_ID`

## 🌟 الميزات المتقدمة

### تحسين الأداء
- OPcache تلقائي
- ضغط Gzip
- تخزين مؤقت للمتصفح
- تحسين الاستعلامات

### الأمان
- حماية من XSS و CSRF
- تشفير الجلسات
- إخفاء معلومات الخادم
- فلترة SQL Injection

### المراقبة
- سجلات مفصلة
- تتبع الأخطاء
- معلومات النشر
- إحصائيات الأداء

## 📞 الدعم

في حالة وجود مشاكل:

1. فحص ملف `/health` للتأكد من عمل التطبيق
2. مراجعة `storage/logs/laravel.log`
3. التأكد من إعدادات قاعدة البيانات في `.env`
4. تشغيل `php artisan about` لعرض معلومات النظام

## 🎯 الخطوات التالية

بعد التثبيت الناجح:

1. ✅ تحديث بيانات قاعدة البيانات في `.env`
2. ✅ إعداد كلمة مرور Apple Wallet
3. ✅ توجيه الخادم إلى مجلد `public/`
4. ✅ اختبار التطبيق عبر `/health`
5. ✅ إعداد النسخ الاحتياطية المجدولة

---

## 🏆 إصدارات النشر

يستخدم النظام نظام إصدارات تلقائي:
- v1.0, v1.1, v1.2... إلخ
- عند الوصول لـ v1.9 ينتقل لـ v2.0
- كل commit يحصل على رقم إصدار جديد

## 🎉 تهانينا!

تم تثبيت نظام الولاء بنجاح! 🚀

نظامك الآن جاهز للعمل بدون مشاكل أو أخطاء 500.